---
import BaseLayout from "../layouts/BaseLayout.astro";
import { generateSitemapEntries, getTotalPageCount } from "../lib/sitemap";
import nichesData from "../data/niches.json";

const entries = generateSitemapEntries();
const totalPages = getTotalPageCount();

// Group entries by type
const homePage = entries.find(e => e.url === '/');
const nichePages = entries.filter(e => e.url.split('/').length === 2 && e.url !== '/');
const productPages = entries.filter(e => e.url.split('/').length === 3);

// Group by niche
const pagesByNiche = nichesData.niches.map(niche => ({
  ...niche,
  pages: productPages.filter(p => p.url.startsWith(`/${niche.slug}/`))
}));

const title = "Sitemap | Linefulness";
const description = `Complete sitemap with ${totalPages} pages including all niches and product pages.`;
---

<BaseLayout title={title} description={description} canonical="/sitemap">
  <div class="py-12">
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-base-900">Sitemap</h1>
      <p class="text-base-500 mt-2">
        {totalPages} pages indexed across {nichesData.niches.length} niches
      </p>
    </div>

    <!-- Homepage -->
    <section class="mb-12">
      <h2 class="text-xl font-semibold text-base-900 mb-4">Homepage</h2>
      <div class="bg-base-50 rounded-xl p-4">
        <a href="/" class="text-orange-600 hover:text-orange-700 font-medium">
          {homePage?.url}
        </a>
        <span class="text-sm text-base-400 ml-2">Priority: {homePage?.priority}</span>
      </div>
    </section>

    <!-- Niche Pages -->
    <section class="mb-12">
      <h2 class="text-xl font-semibold text-base-900 mb-4">Niche Collections</h2>
      <div class="grid gap-3">
        {nichePages.map((page) => (
          <div class="flex items-center justify-between bg-base-50 rounded-xl p-4">
            <div>
              <a href={page.url} class="text-orange-600 hover:text-orange-700 font-medium">
                {page.url}
              </a>
              <span class="text-sm text-base-400 ml-2">Priority: {page.priority}</span>
            </div>
            <span class="text-xs px-2 py-1 bg-orange-100 text-orange-700 rounded-full">
              {pagesByNiche.find(n => page.url.startsWith(`/${n.slug}/`))?.pages.length} products
            </span>
          </div>
        ))}
      </div>
    </section>

    <!-- Product Pages by Niche -->
    {pagesByNiche.map((niche) => (
      <section class="mb-12">
        <div class="flex items-center gap-3 mb-4">
          <span class="text-2xl">{niche.icon}</span>
          <h2 class="text-xl font-semibold text-base-900">{niche.name} Products</h2>
          <span class="text-sm text-base-400">({niche.pages.length} pages)</span>
        </div>
        <div class="grid gap-2 max-h-96 overflow-y-auto p-4 bg-base-50 rounded-xl">
          {niche.pages.map((page) => (
            <div class="flex items-center justify-between py-2 border-b border-base-200 last:border-0">
              <a href={page.url} class="text-base-600 hover:text-orange-600 text-sm">
                {page.url}
              </a>
              <span class="text-xs text-base-400">Priority: {page.priority}</span>
            </div>
          ))}
        </div>
      </section>
    ))}

    <!-- Stats -->
    <section class="border-t border-base-200 pt-8 mt-12">
      <h2 class="text-xl font-semibold text-base-900 mb-4">Sitemap Statistics</h2>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <div class="bg-base-50 rounded-xl p-6 text-center">
          <div class="text-3xl font-bold text-orange-600">{totalPages}</div>
          <div class="text-sm text-base-500">Total Pages</div>
        </div>
        <div class="bg-base-50 rounded-xl p-6 text-center">
          <div class="text-3xl font-bold text-orange-600">{nichesData.niches.length}</div>
          <div class="text-sm text-base-500">Niches</div>
        </div>
        <div class="bg-base-50 rounded-xl p-6 text-center">
          <div class="text-3xl font-bold text-orange-600">{productPages.length}</div>
          <div class="text-sm text-base-500">Product Pages</div>
        </div>
      </div>
    </section>

    <!-- XML Links -->
    <section class="border-t border-base-200 pt-8 mt-8">
      <h2 class="text-xl font-semibold text-base-900 mb-4">XML Sitemaps</h2>
      <div class="flex flex-wrap gap-3">
        <a 
          href="/sitemap-index.xml" 
          class="px-4 py-2 bg-orange-500 text-white rounded-full text-sm font-medium hover:bg-orange-600 transition-colors"
        >
          Sitemap Index
        </a>
        <a 
          href="/sitemap-0.xml" 
          class="px-4 py-2 bg-base-100 text-base-700 rounded-full text-sm font-medium hover:bg-base-200 transition-colors"
        >
          Sitemap 0
        </a>
      </div>
    </section>
  </div>
</BaseLayout>
